{# templates/dashboard/dashboard.html #}
{% extends "shared/base.html" %}

{% block header %}
  {% include "dashboard/dashboard_header.html" %}
{% endblock %}

{% block main %}
<div class="layout">
  <div class="sidebar-container">

    <div class="sidebar-header">
      <button id="sidebar-toggle" class="sidebar-toggle-btn" aria-label="Toggle Sidebar">
        ◀
      </button>
    </div>

    <!-- Sidebar fijo -->
    <aside class="sidebar">
      
      {% from "components/sidebar_section.html" import sidebar_section %}
      
      <!-- Solo Admin -->
      {% if has_role(current_user, "admin") %}
        <div class="sidebar-menu-main">
          <a href="{{ url_for('admin.adminboard_index') }}">
            <img src="{{ url_for('static', filename='icons/address-white.svg') }}" class="sidebar-icon">
            Adminboard
          </a>
        </div>
        
        {{ sidebar_section("Admin", "admin-white.svg", [
          {"label": "System Catalogs", "icon": "catalogs-white.svg", "endpoint": "admin.list_models", "visible": has_role(current_user, "admin")},
          {"label": "Routes", "icon": "routes-white.svg", "endpoint": "admin.routes_show_routes_summary", "visible": has_role(current_user, "admin")},
          {"label": "Users", "icon": "users-white.svg", "endpoint": "admin.models_overview_view", "args": {"model_name": "user"}, "visible": has_role(current_user, "admin")},
          {"label": "Roles", "icon": "roles-white.svg", "endpoint": "admin.models_overview_view", "args": {"model_name": "role_catalog"}, "visible": has_role(current_user, "admin")}, 
          {"label": "Plans", "icon": "plans-white.svg", "endpoint": "admin.models_overview_view", "args": {"model_name": "plan_catalog"}, "visible": has_role(current_user, "admin")},
          {"label": "Logs", "icon": "logs-white.svg", "endpoint": "admin.models_overview_view", "args": {"model_name": "log"}, "visible": has_role(current_user, "admin")},
          {"label": "Docs", "icon": "scroll-white.svg", "endpoint": "admin.md_index_admindocs", "visible": has_role(current_user, "admin")},
          {"label": "Setups", "icon": "settings-white.svg", "endpoint": "admin.seeds_setup_index", "visible": has_role(current_user, "admin")},
          {"label": "Maintenance", "icon": "wrench-white.svg", "endpoint": "admin.tools_dashboard", "visible": has_role(current_user, "admin")},
          {"label": "Mocks", "icon": "flame-white.svg", "endpoint": "admin.mock_index", "visible": has_role(current_user, "admin")},
        ]) }}
        
      {% endif %}
      
      <!-- TODOS LOS USUARIOS -->
      {% if has_role(current_user, "admin", "premium", "pro", "plus", "user") %}
        <div class="sidebar-menu-main">
          <!-- Accesible para todos los logueados -->
          <a href="{{ url_for('quickboard.index') }}">
            <img src="{{ url_for('static', filename='icons/address-white.svg') }}" class="sidebar-icon">
            Dashboard
          </a>
        </div>
        
        {{ sidebar_section("Account", "user-white.svg", [
          {"label": "Perfil", "icon": "edituser-white.svg", "endpoint": "user.profile.view", "visible": True},
          {"label": "Constraseña", "icon": "lock-white.svg", "endpoint": "auth.change_password.change_password", "visible": True},
          {"label": "Desactivar Cuenta", "icon": "warning-white.svg", "endpoint": "auth.deactivate.deactivate_account", "visible": True},
        ]) }}
      {% endif %}
      
      <!-- CON ROLES ASIGNADOS-->
      {% if has_role(current_user, "admin", "premium", "pro", "plus", "user") %}
        {% if empresa_activa %}
          {{ sidebar_section("Empresas", "building-white.svg", [
            {"label": "Empresa", "icon": "building-white.svg", "endpoint": "company.company_views.empresa_overview", "visible": True},
            {"label": "Crear Empresa", "icon": "add-item-white.svg", "endpoint": "company.setup.views.show_empresa_setup", "visible": True},
            {"label": "Cambiar Empresa", "icon": "change-white.svg", "endpoint": "company.company_views.listar_empresas", "visible": True},     
          ]) }}
          {{ sidebar_section("Assets", "devices-white.svg", [
            {"label": "Catálogos", "icon": "catalogs-white.svg", "endpoint": "assets.list_tenant_models", "visible": True},
            {"label": "Usuarios", "icon": "users-white.svg", "endpoint": "assets.tenant_models_overview_view", "args": {"model_name": "asset_user"}, "visible": True},
            {"label": "PCs", "icon": "pcs-white.svg", "endpoint": "assets.tenant_models_overview_view", "args": {"model_name": "pc"}, "visible": True},
            {"label": "Celulares", "icon": "phone-white.svg", "endpoint": "assets.tenant_models_overview_view", "args": {"model_name": "celular"}, "visible": True},
            {"label": "Periféricos", "icon": "printer-white.svg", "endpoint": "assets.tenant_models_overview_view", "args": {"model_name": "periferico"}, "visible": True},
            {"label": "Software", "icon": "save-white.svg", "endpoint": "assets.tenant_models_overview_view", "args": {"model_name": "software_license"}, "visible": True},
            {"label": "Dispositivos por tipo", "icon": "devices-white.svg", "endpoint": "assets.tenant_models_overview_view", "args": {"model_name": "device_type"}, "visible": True},
            {"label": "Bitacoras de Mantenimiento", "icon": "clean-white.svg", "endpoint": "assets.list_tenant_models", "visible": True},
            {"label": "Ajustes", "icon": "wrench-white.svg", "endpoint": "assets.list_tenant_models", "visible": True},
          ]) }}
        {% else %}
          {{ sidebar_section("Setup Inicial", "settings-white.svg", [
            {"label": "Configurar Empresa", "icon": "assets-white.svg", "endpoint": "company.setup.entrypoint.company_entrypoint", "visible": True},
          ]) }}
        {% endif %}
      {% endif %}
    </aside>
  </div>
  <!-- Contenido dinámico -->
  <div class="main-content">
    {% block dashboard_content %}{% endblock %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/components/sidebar.js') }}?v={{ ASSET_VERSION }}"></script>
{% endblock %}