{% extends "dashboard/dashboard.html" %}

{% block title %}Crear item de catálogo {{ title }}{% endblock %}

{% block dashboard_content %}

<div class="control-bar">

  <h5 class="control-bar-title">
    <img src="{{ url_for('static', filename='icons/catalogs-white.svg') }}" alt="Catalog" class="title-icon">
    {{ title }}
  </h5>

  <button class="button-link back-btn" data-back="{{ back_url or '/' }}">
    <img src="{{ url_for('static', filename='icons/arrow-back-white.svg') }}" alt="Back" class="btn-icon">
    Regresar
  </button>

</div>

<div class="box autofit dark left">

  <form id="create-form"
    data-model-name="{{ model_name }}"
    data-action-url="{{ action_url }}"
    data-redirect-url="{{ redirect_url }}">

    {% for field in fields %}

      <div class="row horizontal">
        <label class="label dark md" for="{{ field.field }}">
          {{ field.field.replace('_', ' ').capitalize() }}
        </label>

        {# 1) Select con opciones dinámicas #}
        {% if choices.get(field.field) %}
          <select name="{{ field.field }}" id="{{ field.field }}" {% if field.required %} required {% endif %}>
            {% if field.required %}
              <option value="" disabled selected>— seleccionar —</option>
            {% endif %}
            {% for item in choices[field.field] %}
              <option value="{{ item.value }}">{{ item.label }}</option>
            {% endfor %}
          </select>

        {# 2) Password con criterios y toggle #}
        {% elif field.field == "password" %}
          <div class="password-wrapper">
            <input 
              class="input sm password-input"
              type="password"
              id="{{ field.field }}"
              name="{{ field.field }}"
              placeholder="{{ field.hint }}"
              title="{{ field.hint }}"
              {% if field.required %} required {% endif %}
              data-password-check
              autocomplete="new-password"
            >
            <button type="button" class="toggle-password" aria-label="Mostrar/Ocultar contraseña">
              <img src="{{ url_for('static', filename='icons/eye-open-black.svg') }}" alt="Mostrar" class="eye-icon">
            </button>
          </div>

        {# 3) Confirmación de contraseña con toggle #}
        {% elif field.field == "confirm_password" %}
          <div class="password-wrapper">
            <input 
              class="input sm password-input"
              type="password"
              id="{{ field.field }}"
              name="{{ field.field }}"
              placeholder="{{ field.hint }}"
              title="{{ field.hint }}"
              {% if field.required %} required {% endif %}
            >
            <button type="button" class="toggle-password" aria-label="Mostrar/Ocultar contraseña">
              <img src="{{ url_for('static', filename='icons/eye-open-black.svg') }}" alt="Mostrar" class="eye-icon">
            </button>
          </div>

        {# 4) Input texto por defecto #}
        {% else %}
          <input 
            class="input sm"
            type="text"
            id="{{ field.field }}"
            name="{{ field.field }}"
            placeholder="{{ field.hint }}"
            title="{{ field.hint }}"
            {% if field.required %} required {% endif %}
          >
        {% endif %}
      </div>

      {# Criterios bajo el password (solo cuando el campo es 'password') #}
      {% if field.field == "password" %}
      <div class="row horizontal center">
        <div id="password-criteria" class="password-criteria-row">
          <span id="lenCheck" class="password-label">❌ 8 caracteres</span>
          <span id="lowerCheck" class="password-label">❌ minúscula</span>
          <span id="upperCheck" class="password-label">❌ Mayúscula</span>
          <span id="digitCheck" class="password-label">❌ Número</span>
          <span id="symbolCheck" class="password-label">❌ Símbolo</span>
        </div>
      </div>
      {% endif %}

    {% endfor %}

    {% if (fields | selectattr('field','equalto','password') | list | length) 
          and not (fields | selectattr('field','equalto','confirm_password') | list | length) %}
      <div class="row horizontal">
        <label class="label dark md" for="confirm_password">Confirmar</label>
        <div class="password-wrapper">
          <input 
            class="input sm password-input"
            type="password"
            id="confirm_password"
            name="confirm_password"
            placeholder="Confirmar contraseña"
            title="Confirmar contraseña"
            required
            autocomplete="new-password"
          >
          <button type="button" class="toggle-password" aria-label="Mostrar/Ocultar contraseña">
            <img src="{{ url_for('static', filename='icons/eye-open-black.svg') }}" alt="Mostrar" class="eye-icon">
          </button>
        </div>
      </div>
    {% endif %}

    <span id="catalogerror" class="message flashes error hidden"></span>

    <div class="box button-layout">
      <button type="submit" class="button button-success">
        <img src="{{ url_for('static', filename='icons/save-white.svg') }}" alt="Back" class="btn-icon">
        Guardar
      </button>
    </div>

  </form>

</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/components/sidebar.js') }}?v={{ ASSET_VERSION }}"></script>
<script src="{{ url_for('static', filename='js/auth/password.js') }}?v={{ ASSET_VERSION }}" type="module"></script>
<script src="{{ url_for('static', filename='js/models/custom/create_user.module.js') }}?v={{ ASSET_VERSION }}" type="module"></script>
{% endblock %}
